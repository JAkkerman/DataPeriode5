<!-- Joos Akkerman (11304723) -->
<!-- This document visualizes data concerning the percentage of renewable energy
produced by OECD member countries -->

<!DOCTYPE html>
<html>
  <head>
    <title>OECD Barchart</title>
  </head>

  <style>

			/* .bar {
				display: inline-block;
				width: 40px;
        margin-right: 3px;
				background-color: #0ba828;
			} */

      .d3-tip {
        line-height: 1;
        padding: 12px;
        background: rgb(92, 221, 56);
        color: #fff;
        border-radius: 1px;
        font-family: arial;
        font-size: 10px;
      }

  </style>

  <body>
    <p><b>OECD data on renewable energy</b></p>
    <p><i>This barchart shows the percentage of the total electricity
          production that comes from renewable sources.</i></p>
    <p>Joos Akkerman (11304723)</p>

    <!-- This is where your bar chart will go -->
    <script src="https://d3js.org/d3.v5.min.js"></script>

    <!-- <script src="http://labratrevenge.com/d3-tip/javascripts/d3.tip.v0.6.3.js"></script> -->

    <script src="d3-tip.js"></script>

    <script type="text/javascript">

        d3.json("data.json").then(function(data) {
          // console.log(data)

          d3.select("body").selectAll("div")

              var w = 750;
              var h = 300;
              var start_w = 30;
              var end_w = 0.9*w;
              var start_h = 10;
              var end_h = 0.9*h;
              var barPadding = 2;
              var svg = d3.select("body")
                .append("svg")
                .attr("width", w)
                .attr("height", h);

              var xScale = d3.scaleBand()
                                   .domain(['NLD', 'BEL', 'USA', 'IRL', 'FRA', 'CZE', 'HUN', 'GRC', 'DEU', 'ITA', 'CAN', 'PRT', 'DNK', 'AUT', 'FIN', 'NOR', 'ISL'])
                                   .range([start_w, end_w]);

              var yScale = d3.scaleLinear()
                                   .domain([100, 0])
                                   .range([start_h, end_h - 10]);

              var xAxis = d3.axisBottom(xScale);

              var yAxis = d3.axisLeft(yScale);

              var tip = d3.tip()
              .attr('class', 'd3-tip')
              .offset([-10, 0])
              .html(function(d) {
                return "<strong>Renewable Energy: </strong>" + d["%RENEW"] + "%</span>";
              })

              svg.selectAll("rect")
                .data(data)
                .enter()
                .append("rect")
                .attr("class", ".bar")
                .attr("y", function(d) {
                    console.log(yScale(d["%RENEW"]))
                    return h + start_h - (h + start_h - yScale(d["%RENEW"])) + 10;
                  })
                .attr("width", (w - start_w - (w - end_w)) / data.length - barPadding)
                .attr("height", function(d) {
                    return (h - start_h) - yScale(d["%RENEW"]) - (h - end_h);
                  })
                .attr("x", function(d, i) {
                    return start_w + i * ((w - start_w - (w - end_w)) / data.length);
                  })
                .attr("fill", function(d) {
                  if (d["%RENEW"] > 70) {
                    return "rgb(0, 252, 1)";
                  }
                  else if (d["%RENEW"] > 40) {
                    return "rgb(178, 254, 1)";
                  }
                  else if (d["%RENEW"] > 25) {
                    return "rgb(176, 252, 99)";
                  }
                  else if (d["%RENEW"] > 10) {
                    return "rgb(231, 252, 99)";
                  }
                  else {
                    return "rgb(162, 106, 75)";
                  }
                  })
                  .on('mouseover', tip.show)
                  // .on('mouseover', function(d){
                  //   d3.select(this).attr("r", 10).style("fill", "red");
                  // })
                  .on('mouseout', tip.hide);
                  // .on('mouseout', function(d){
                  //    d3.select(this).attr("r", 5.5).style("fill", "#fff8ee");
                  // });

                svg.call(tip);

                svg.append("g")
                    .attr("transform", "translate(0, "+ end_h +")")
                    .call(xAxis);

                svg.append("g")
                    .attr("transform", "translate("+ start_w +", "+ start_h +")")
                    .call(yAxis);


                // svg.selectAll("text")
                //  .data(data)
                //  .enter()
                //  .append("text")
                //  .text(function(d) {
                //         return d["%RENEW"];
                //   })
                //   .attr("x", function(d, i) {
                //        return i * (w / data.length) + (w / data.length - barPadding) / 2;
                //   })
                //   .attr("y", function(d) {
                //        return h - (3*d["%RENEW"]-14);
                //   })
                //   .attr("font-family", "sans-serif")
                //   .attr("font-size", "12px")
                //   .attr("text-anchor", "middle");

              });

    </script>
  </body>
</html>
